<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Orientation √âtudiant</title>
  
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
{% load static %}

  <style>
    body {
      font-family: "Inter", sans-serif;
      background-color: #fafafa;
      color: #333;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }

    .intro-orientation {
      background-color: #fcfcfc;
      border: 0.25px solid #0443f1;
      border-radius: 15px;
      padding: 40px 60px;
      max-width: 1200px;
      margin: 40px auto;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.05);
    }
      .container  {
        background-color: #e5d2f5;
      border: 0.25px solid #969696;
      border-radius: 15px;
      padding: 40px 60px;
      max-width: 1200px;
      margin: 40px auto;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.05);

      }
    .intro-orientation h3 {
      text-align: center;
      color: #222;
      font-size: 1.6rem;
      margin-bottom: 25px;
    }

    .intro-orientation p {
      text-align: justify;
      margin-bottom: 15px;
      font-size: 1rem;
    }

    .intro-orientation ul {
      margin-left: 50px;
      margin-bottom: 20px;
      font-size: 0.95rem;
    }

    .intro-orientation h4 {
      text-align: left;
      color: #8B0000;
      font-weight: bold;
    }

    /* --- Image Slider --- */
    .image-slider {
      position: relative;
      width: 100%;
      max-width: 1200px;
      height: 280px; /* moins haut */
      margin: 20px auto 40px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .image-slider img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transform: scale(1.05);
      transition: opacity 1.5s ease, transform 3s ease;
    }

    .image-slider img.active {
      opacity: 1;
      transform: scale(1);
    }

    @media (max-width: 900px) {
      .intro-orientation {
        padding: 25px;
      }
      .image-slider {
        height: 200px;
      }
      .intro-orientation h3 {
        font-size: 1.3rem;
      }
    }

    


    
.form-step {
  display: none;
  transition: opacity 0.5s ease;
}
.form-step.active {
  display: block;
  opacity: 1;
}

h4 {
  color: #2e3b4e;
  font-weight: 600;
  margin-bottom: 20px;
}

/* --- √âtape 1 --- */
.student-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.info-group label {
  font-weight: 500;
  color: #34495e;
  margin-bottom: 6px;
  display: block;
}

.info-group input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ab0ee9;
  transition: 0.3s;
}
.info-group input:focus {
  border-color: #840ea8;
  box-shadow: 0 0 5px rgba(146, 18, 179, 0.747);
}

/* --- √âtape 2 : Sp√©cialit√©s --- */
.specialty-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 20px;
}

.specialty-card {
  background: #fff;
  border-radius: 12px;
  padding: 15px;
  border: 1px solid #0e0d0d;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  cursor: pointer;
}
.specialty-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.specialty-card.selected {
  border: 2px solid #9908d3;
  background: #f0d4f7;
}
.specialty-card p {
  font-size: 14px;
  color: #555;
  margin-top: 8px;
}

/* Badge de num√©rotation */
.order-badge {
  position: absolute;
  top: 8px;
  right: 8px;
  background: #9c0ed4;
  color: #fff;
  font-weight: 600;
  font-size: 13px;
  width: 26px;
  height: 26px;
  line-height: 26px;
  border-radius: 50%;
  display: none;
}
.specialty-card.selected .order-badge {
  display: inline-block;
}

/* --- √âtape 3 --- */
.summary {
  list-style: none;
  padding: 0;
  color: #333;
}
.summary li {
  margin-bottom: 8px;
}

/* --- Boutons --- */
button {
  border: none;
  border-radius: 8px;
  padding: 10px 20px;
  cursor: pointer;
  transition: background 0.3s ease;
}
.btn-next {
  background: #ae3edf;
  color: white;
}
.btn-next:hover {
  background: #b736eb;
}
.btn-prev {
  background: #e49fff;
  color: #333;
}
.btn-send-choice {
  background: #9c0ed4;
  color: white;
}
.btn-send-choice:hover {
  background: #9c0ed4;
}

/* --- Barre de progression --- */
.progressbar {
  display: flex;
  justify-content: space-between;
  position: relative;
  margin: 40px 0;
}
.progressbar::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  width: 100%;
  height: 4px;
  background-color: #fbf6fc;
  z-index: 0;
}
.progress {
  position: absolute;
  top: 50%;
  left: 0;
  height: 4px;
  background-color: #9f25c7;
  width: 0%;
  z-index: 1;
  transition: width 0.4s ease;
}
.progress-step {
  width: 20px;
  height: 20px;
  background: #a12fb8;
  border-radius: 50%;
  z-index: 2;
}
.progress-step.active {
  background: #9c0ed4;
}

  </style>
</head>
<body>

  <div class="intro-orientation">
    <h3>
      Orientation et choix des parcours ‚Äì 3√®me ann√©e Licence Sciences de Gestion<br>
      Ann√©e universitaire : <strong id="academic-year"></strong>
    </h3>

    <div class="image-slider">
      <img src="{% static 'img/iriotation1.jfif' %}" alt="orientation" class="slide active">
      <img src="{% static 'img/iriotation2.jfif' %}" alt="orientation" class="slide">
      <img src="{% static 'img/iriotation3.jfif' %}" alt="orientation" class="slide">
    </div>

    <p>
      Il est port√© √† la connaissance des √©tudiants ayant 
      r√©ussi la 2√®me ann√©e Licence en Sciences de Gestion 
      qu'ils peuvent d√®s √† pr√©sent remplir leurs choix
       de parcours dans les sp√©cialit√©s suivantes, 
       et ce au plus tard le<strong>07 septembre √† minuit</strong>, en utilisant leurs adresses e-mail institutionnelles.
    </p>

    <ul>
      <li>Finance</li>
      <li>Marketing</li>
      <li>Management</li>
      <li>Logistique</li>
      <li>Comptabilit√©</li>
    </ul>

    <p><strong>L‚Äôaffectation d√©pendra :</strong></p>
    <ul>
      <li>De l‚Äôordre des choix</li>
      <li>De la capacit√© d‚Äôaccueil</li>
      <li>
        Du score calcul√© sur la base de :
        <br>‚Ä¢ La moyenne g√©n√©rale
        <br>‚Ä¢ La moyenne des √©l√©ments sp√©cifiques
        <br>‚Ä¢ Un bonus de +0.5 si la session d‚Äôadmission est principale
      </li>
    </ul>

    <p>
      <strong>NB :</strong> En cas de probl√®me, veuillez contacter le GEL de l'ISGB via :  
      <a href="mailto:cet@isgb.ucar.tn?subject=Assistance%20Orientation&body=Bonjour,%20j%27ai%20besoin%20d%27aide%20concernant%20mon%20choix%20de%20sp√©cialit√©.">
  cet@isgb.ucar.tn
</a>

    </p>

    <h4 style="font-weight:bold; margin-bottom:15px;">
      VOTRE CHOIX D'ORIENTATION</h4> 
      <div style="margin-left:10px;"> 
        <!-- Finance --> 
         <h4 style="color:#8B0000; margin-bottom:5px;">
          ‚û§ 3√®me ann√©e - Finance</h4> 
          <p style="margin-bottom:15px;"> 
            <strong>Score = (Moyenne g√©n√©rale + Moyenne des √©l√©ments sp√©cifiques + 0.5 bonus si session principale) / 2</strong>
            <br> <em>√âl√©ments sp√©cifiques :</em> Math√©matiques financi√®res, Diagnostic financier </p>
             <!-- Marketing --> <h4 style="color:#8B0000; margin-bottom:5px;">
              ‚û§ 3√®me ann√©e - Marketing</h4> <p style="margin-bottom:15px;"> 
                <strong>Score = (Moyenne g√©n√©rale + Moyenne des √©l√©ments sp√©cifiques + 0.5 bonus si session principale) / 2</strong>
                <br> <em>√âl√©ments sp√©cifiques :</em> Principes de gestion 1 & 2, Fondements du marketing </p> 
                <!-- Management -->
                  <h4 style="color:#8B0000; margin-bottom:5px;">
                    ‚û§ 3√®me ann√©e - Management</h4> <p style="margin-bottom:15px;">
                       <strong>Score = (Moyenne g√©n√©rale + Moyenne des √©l√©ments sp√©cifiques + 0.5 bonus si session principale) / 2</strong>
                       <br> <em>√âl√©ments sp√©cifiques :</em> Principes de gestion 1 & 2, Fondements du management </p>
                        <!-- Logistique --> 
                         <h4 style="color:#8B0000; margin-bottom:5px;">
                          ‚û§ 3√®me ann√©e - Logistique</h4>
                           <p style="margin-bottom:15px;"> 
                            <strong>Score = (Moyenne g√©n√©rale + Moyenne des √©l√©ments sp√©cifiques + 0.5 bonus si session principale) / 2</strong>
                            <br> <em>√âl√©ments sp√©cifiques :</em> Principes de gestion 1 & 2, Gestion de production </p>
  </div>




{% if existing_choice %}
  <p style="color: red; font-weight: bold; text-align: center;">
    ‚ö†Ô∏è Vous avez d√©j√† envoy√© ce formulaire. Vous pouvez le modifier et le renvoyer.
  </p>
{% endif %}


<div class="container py-4">
    

<form id="specialtyForm" action="{% url 'student_dashboard' %}" method="post">
  {% csrf_token %}

  <!-- √âtape 1 : Informations personnelles -->
  <div class="form-step active" id="step1">
    <h3>√âtape 1 : Informations personnelles</h3>
    <div class="student-info">
      <div class="info-group">
        <label>Num√©ro d‚Äôinscription</label>
       <input type="text" id="inscription" name="inscription"
       value="{{ existing_choice.inscription|default_if_none:'' }}" required>
      </div>

      <div class="info-group">
        <label>Nom</label>
        <input type="text" name="last_name"
         value="{{ existing_choice.last_name|default:user.last_name }}" readonly>
      </div>

      <div class="info-group">
        <label>Pr√©nom</label>
       <input type="text" name="first_name"
         value="{{ existing_choice.first_name|default:user.first_name }}" readonly>
      </div>

      <div class="info-group">
        <label>CIN</label>
        
<input type="text" id="cin" name="identite"
       value="{{ existing_choice.identite|default_if_none:'' }}" required>
      </div>

      <div class="info-group">
        <label>Date de naissance</label>
        
<input type="date" id="birth_date" name="birth_date"
       value="{{ existing_choice.birth_date|date:'Y-m-d' }}" required>
      </div>

      <div class="info-group">
        <label>Email institutionnel</label>
         <input type="email" name="email"
         value="{{ existing_choice.email|default:user.email }}" readonly>
      </div>
    </div>

    <button type="button" class="btn-next float-end">Suivant ‚Üí</button>
  </div>

   <!-- √âtape 2 : Choix des sp√©cialit√©s -->
<div class="form-step" id="step2">
  <h3>√âtape 2 : Classez vos sp√©cialit√©s par ordre de pr√©f√©rence</h3>
  <p class="text-muted">Cliquez sur les sp√©cialit√©s selon votre pr√©f√©rence (1Ô∏è‚É£ = premier choix, 2Ô∏è‚É£ = deuxi√®me, etc.).</p>

  <div class="specialty-grid" id="specialtySelection">
    <div class="specialty-card" data-value="Finance">
      üí∞ <strong>Finance</strong>
      <p>Gestion financi√®re et investissements.</p>
      <span class="order-badge"></span>
    </div>
    <div class="specialty-card" data-value="Management">
      üìä <strong>Management</strong>
      <p>Strat√©gie et leadership.</p>
      <span class="order-badge"></span>
    </div>
    <div class="specialty-card" data-value="Marketing">
      üéØ <strong>Marketing</strong>
      <p>Comportement des consommateurs et communication.</p>
      <span class="order-badge"></span>
    </div>
    <div class="specialty-card" data-value="Logistique">
      üöö <strong>Logistique</strong>
      <p>Organisation et cha√Æne d‚Äôapprovisionnement.</p>
      <span class="order-badge"></span>
    </div>

  </div>

  <input type="hidden" name="order_preference" id="order_preference"
       value="{{ existing_choice.order_preference|default_if_none:'' }}">


  <div class="buttons-step text-end mt-3">
    <button type="button" class="btn-prev">‚Üê Pr√©c√©dent</button>
    <button type="button" class="btn-next">Suivant ‚Üí</button>
  </div>
</div>

  <!-- √âtape 3 : Confirmation -->
<div class="form-step" id="step3">
  <h3>√âtape 3 : Confirmation</h3>
  <p class="text-muted">V√©rifiez vos informations avant de soumettre.</p>
  <ul class="summary">
    <li><strong>Num√©ro d'inscription :</strong> <span id="conf_insc"></span></li>
    <li><strong>Nom :</strong> {{ user.last_name }}</li>
    <li><strong>Pr√©nom :</strong> {{ user.first_name }}</li>
    <li><strong>CIN :</strong> <span id="conf_cin"></span></li>
    <li><strong>Date de naissance :</strong> <span id="conf_birth"></span></li>
    <li><strong>Email :</strong> {{ user.email }}</li>
  </ul>
  <p><strong>Ordre de pr√©f√©rence :</strong> <span id="summaryOrder"></span></p>

  <div class="buttons-step text-end">
    <button type="button" class="btn-prev">‚Üê Retour</button>

{% if existing_choice %}
  <button type="submit" class="btn-send-choice btn-warning">
    üîÑ Mettre √† jour
  </button>
{% else %}
  <button type="submit" class="btn-send-choice btn-success">
    ‚úÖ Envoyer
  </button>
{% endif %}


  </div>
</div>

  </form>

  <!-- Barre de progression -->
  <div class="progressbar">
    <div class="progress" id="progress"></div>
    <div class="progress-step active"></div>
    <div class="progress-step"></div>
    <div class="progress-step"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<!-- Modal de succ√®s cach√© au d√©part -->
<div id="successModal" class="modal fade" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <h3>‚úÖ Votre formulaire a bien √©t√© envoy√© !</h3>
      <p>Merci, vos informations ont √©t√© transmises √† l‚Äôadministrateur.</p>
      <button type="button" class="btn btn-success mt-3" data-bs-dismiss="modal">Fermer</button>
    </div>
  </div>
</div>

<script>
   

 function getAcademicYear() {
    const now = new Date();
    const year = now.getFullYear();
    // Exemple : si on est en 2025 ‚Üí 2025/2026
    return `${year}/${year + 1}`;
  }

  // Ins√®re dynamiquement l‚Äôann√©e dans l‚Äô√©l√©ment HTML pr√©vu
  document.addEventListener("DOMContentLoaded", function () {
    const yearSpan = document.getElementById("academic-year");
    if (yearSpan) {
      yearSpan.innerText = getAcademicYear();
    }
  });


  let slides = document.querySelectorAll('.image-slider .slide');
let currentSlide = 0;

function changeSlide() {
  slides[currentSlide].classList.remove('active');
  currentSlide = (currentSlide + 1) % slides.length;
  slides[currentSlide].classList.add('active');
}

// Change d‚Äôimage toutes les 4 secondes
setInterval(changeSlide, 4000);






document.addEventListener("DOMContentLoaded", () => {
  const formSteps = document.querySelectorAll(".form-step");
  const nextBtns = document.querySelectorAll(".btn-next");
  const prevBtns = document.querySelectorAll(".btn-prev");
  const progressSteps = document.querySelectorAll(".progress-step");
  const progress = document.getElementById("progress");
  const specialtyCards = document.querySelectorAll(".specialty-card");
  const specialtyOrderInput = document.getElementById("order_preference");
  const form = document.getElementById("specialtyForm");
  let formStepNum = 0;
  let selectedOrder = [];

  // ========================
  // √âtapes formulaire
  // ========================
  nextBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      if (formStepNum === 0) {
        const cin = document.getElementById('cin').value.trim();
        const birthDate = document.getElementById('birth_date').value;
        const insc = document.getElementById('inscription').value.trim();
        if (!cin || !birthDate || !insc) {
          alert("Veuillez remplir tous les champs obligatoires.");
          return;
        }
      }
      if (formStepNum === 1 && selectedOrder.length !== 4) {
        alert("Veuillez choisir les 4 sp√©cialit√©s avant de continuer.");
        return;
      }
      formStepNum++;
      updateFormSteps();
    });
  });

  prevBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      if (formStepNum > 0) formStepNum--;
      updateFormSteps();
    });
  });

  function updateFormSteps() {
    formSteps.forEach((step, i) => step.classList.toggle("active", i === formStepNum));
    progressSteps.forEach((step, i) => step.classList.toggle("active", i <= formStepNum));
    progress.style.width = `${(formStepNum / (progressSteps.length - 1)) * 100}%`;

    if (formStepNum === 2) {
      document.getElementById("conf_insc").textContent = document.getElementById("inscription").value;
      document.getElementById("conf_cin").textContent = document.getElementById("cin").value;
      document.getElementById("conf_birth").textContent = document.getElementById("birth_date").value;
      document.getElementById("summaryOrder").textContent = selectedOrder
        .map((item, index) => `${index + 1} - ${item}`)
        .join("     ");
    }
  }

  // ========================
  // S√©lection des sp√©cialit√©s
  // ========================
  specialtyCards.forEach(card => {
    card.addEventListener("click", () => {
      const value = card.dataset.value;
      if (selectedOrder.includes(value)) {
        selectedOrder = selectedOrder.filter(v => v !== value);
        card.classList.remove("selected");
        card.querySelector(".order-badge").textContent = "";
      } else if (selectedOrder.length < 4) {
        selectedOrder.push(value);
        card.classList.add("selected");
      }
      specialtyCards.forEach(c => {
        const index = selectedOrder.indexOf(c.dataset.value);
        c.querySelector(".order-badge").textContent = index >= 0 ? index + 1 : "";
      });
      specialtyOrderInput.value = selectedOrder.join(",");
    });
  });

 
});
</script>


</body>
</html>
